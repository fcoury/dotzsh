#!/bin/bash

set -e

for b in $(git branch | grep -v '^*'); do
  PR_STATE=`gh pr list --state all --head "$b" --json state | jq -r '.[0].state'`
  if [ "$PR_STATE" == "MERGED" ]; then
    CM_STATES=(`git rev-list --left-right --count "$b"..."origin/$b"`)
    CM_LOCAL="${CM_STATES[0]}"
    CM_REMOTE="${CM_STATES[1]}"
    # echo $b - $PR_STATE - $CM_LOCAL - $CM_REMOTE

    if [ "$CM_LOCAL" == "0" ] && [ "$CM_REMOTE" == "0" ]; then
      echo $b
    fi
  fi
done
# gh pr list --state all --head 'fiketani/fix/id-me-login' --json state
